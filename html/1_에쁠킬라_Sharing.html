<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SoundLetter - 쉐어링</title>
    <link rel="stylesheet" href="../css/1_에쁠킬라_layout.css" />
    <link rel="icon" type="image/svg+xml" href="../favicon.svg?v=2">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=group_add" />
    
    <style>
      .page-title {
        font-size: 32px;
        font-weight: 700;
      }
      
      .main-content {
        padding: 24px 32px 110px 32px !important;
        height: calc(100vh - 110px);
        box-sizing: border-box;
        overflow-y: auto;
        position: relative;
      }

      .header-right {
        margin-bottom:22px;
      }

      /* 설명 */
      .page-description {
          font-size: 14px;
          color: #b3b3b3;
          line-height: 1.6;
      }

      /* 사용자 프로필 드롭다운 */
        .user-profile {
            position: relative;
            cursor: pointer;
            z-index: 100000;
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + 12px);
            right: 0;
            background: #282828;
            border-radius: 12px;
            padding: 20px;
            min-width: 200px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 100000;
            display: none;
        }

        .profile-dropdown.active {
            display: block;
        }

        .profile-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #b3b3b3;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .profile-close-btn:hover {
            color: #ffffff;
        }

        .profile-nickname {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            padding-right: 24px;
        }

        .logout-btn {
            width: 100%;
            padding: 10px 16px;
            background: #ff9500;
            color: #000000;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #ffaa00;
            transform: translateY(-1px);
        }

        /* 쉐어링 컨텐츠 */
        .sharing-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
            height: calc(100vh - 280px);
            justify-content: center;
        }

        /* 중앙 원형 그라데이션 - 원형으로 변경 */
        .center-gradient-circle {
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle at center, 
                rgba(255, 200, 120, 0.18) 0%,
                rgba(255, 210, 135, 0.15) 10%,
                rgba(255, 220, 150, 0.12) 20%,
                rgba(255, 228, 165, 0.09) 30%,
                rgba(250, 235, 180, 0.07) 40%,
                rgba(248, 238, 190, 0.05) 50%,
                rgba(245, 240, 200, 0.04) 60%,
                rgba(242, 242, 210, 0.03) 70%,
                rgba(240, 242, 220, 0.02) 80%,
                rgba(238, 242, 228, 0.01) 90%,
                transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* 사용자 프로필 컨테이너 */
        .users-display-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .users-display-container > * {
            pointer-events: auto;
        }

        /* wifi_tethering 버튼 (왼쪽) */
        .wifi-tethering-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #282828;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .wifi-tethering-btn:hover {
            background: #ff9500;
            transform: scale(1.1);
        }

        .wifi-tethering-btn .material-symbols-outlined {
            font-size: 28px;
            color: white;
        }

        /* 팝업 오버레이 */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100001;
            justify-content: center;
            align-items: center;
        }

        .popup-overlay.active {
            display: flex;
        }

        /* 팝업 컨테이너 */
        .popup-container {
            background: #282828;
            border-radius: 16px;
            padding: 30px;
            width: 450px;
            height: 500px;
            overflow-y: auto;
            position: relative;
        }

        .popup-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: #b3b3b3;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .popup-close-btn:hover {
            color: #ffffff;
        }

        .popup-title {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
        }

        /* 초기 선택 화면 */
        .popup-choice-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .popup-choice-container.hidden {
            display: none;
        }

        .popup-choice-btn {
            padding: 20px;
            background: #1a1a1a;
            border: 2px solid #3a3a3a;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .popup-choice-btn:hover {
            background: #2a2a2a;
            border-color: #ff9500;
        }

        .popup-choice-btn-title {
            font-size: 18px;
            font-weight: 700;
            color: #ff9500;
        }

        .popup-choice-btn-desc {
            font-size: 13px;
            color: #b3b3b3;
        }

        /* 참가하기 화면 */
        .popup-join-container {
            display: none;
        }

        .popup-join-container.active {
            display: block;
        }

        /* 초대하기 화면 */
        .popup-invite-container {
            display: none;
        }

        .popup-invite-container.active {
            display: block;
        }

        .popup-back-btn {
            background: none;
            border: none;
            color: #ff9500;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px 0;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .popup-back-btn:hover {
            color: #ffaa00;
        }

        .popup-input-group {
            margin-bottom: 20px;
        }

        .popup-input-label {
            font-size: 13px;
            color: #b3b3b3;
            margin-bottom: 8px;
            display: block;
        }

        .popup-input {
            width: 100%;
            padding: 12px 16px;
            background: #1a1a1a;
            border: 2px solid #3a3a3a;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }

        .popup-input:focus {
            border-color: #ff9500;
        }

        .popup-submit-btn {
            width: 100%;
            padding: 14px;
            background: #ff9500;
            color: #000000;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .popup-submit-btn:hover {
            background: #ffaa00;
        }

        /* 검색 결과 - 스크롤 형태 */
        .popup-search-results {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }

        .popup-search-results::-webkit-scrollbar {
            width: 6px;
        }

        .popup-search-results::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 3px;
        }

        .popup-search-results::-webkit-scrollbar-thumb {
            background: #ff9500;
            border-radius: 3px;
        }

        .popup-search-results::-webkit-scrollbar-thumb:hover {
            background: #ffaa00;
        }

        .popup-user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #1a1a1a;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .popup-user-item:hover {
            background: #333333;
        }

        .popup-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3a3a3a;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-user-avatar svg {
            width: 24px;
            height: 24px;
            fill: #b3b3b3;
        }

        .popup-user-name {
            flex: 1;
            font-size: 14px;
            color: white;
            font-weight: 500;
        }

        .popup-add-btn {
            padding: 6px 16px;
            background: #ff9500;
            color: #000000;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .popup-add-btn:hover {
            background: #ffaa00;
        }

        /* URL 복사 버튼 */
        .popup-copy-link-btn {
            padding: 12px 16px;
            background: #1a1a1a;
            border: 2px solid #ff9500;
            border-radius: 8px;
            color: #ff9500;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-copy-link-btn:hover {
            background: #ff9500;
            color: #000000;
        }

        .popup-copy-link-btn .material-icons {
            font-size: 20px;
        }

        .center-gradient-text {
            text-align: center;
            color: white;
            position: relative;
            z-index: 5;
        }

        .center-gradient-text h2 {
            font-size: 28px;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
        }

        .center-gradient-text p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Sharing Place 정보 */
        .sharing-place-info {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            font-size: 16px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sharing-place-info.active {
            opacity: 1;
        }

        .sharing-place-host {
            color: #ff9500;
        }

        /* 사용자 프로필 원 - 다양한 크기 */
        .user-profile-circle {
            position: absolute;
            border-radius: 50%;
            background: #282828;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 3px solid #ff9500;
        }

        /* 크기 변화 */
        .user-profile-circle[data-position="0"],
        .user-profile-circle[data-position="5"],
        .user-profile-circle[data-position="10"],
        .user-profile-circle[data-position="15"] {
            width: 100px;
            height: 100px;
        }

        .user-profile-circle[data-position="1"],
        .user-profile-circle[data-position="6"],
        .user-profile-circle[data-position="11"],
        .user-profile-circle[data-position="16"] {
            width: 85px;
            height: 85px;
        }

        .user-profile-circle[data-position="2"],
        .user-profile-circle[data-position="7"],
        .user-profile-circle[data-position="12"],
        .user-profile-circle[data-position="17"] {
            width: 95px;
            height: 95px;
        }

        .user-profile-circle[data-position="3"],
        .user-profile-circle[data-position="8"],
        .user-profile-circle[data-position="13"],
        .user-profile-circle[data-position="18"] {
            width: 80px;
            height: 80px;
        }

        .user-profile-circle[data-position="4"],
        .user-profile-circle[data-position="9"],
        .user-profile-circle[data-position="14"],
        .user-profile-circle[data-position="19"] {
            width: 90px;
            height: 90px;
        }

        .user-profile-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(255, 149, 0, 0.4);
        }

        .user-profile-avatar {
            width: 60%;
            height: 60%;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
            overflow: hidden;
        }

        .user-profile-avatar svg {
            width: 36px;
            height: 36px;
            fill: #b3b3b3;
        }

        .user-profile-name {
            font-size: 10px;
            font-weight: 600;
            color: white;
            text-align: center;
            max-width: 80%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .user-profile-remove {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff4444;
            border: 2px solid #121212;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .user-profile-circle:hover .user-profile-remove {
            opacity: 1;
        }

        .user-profile-remove svg {
            width: 14px;
            height: 14px;
            fill: white;
        }

        /* 위치 설정 - 원 안 전체에 20명 분산 배치 */
        .user-profile-circle[data-position="0"] { top: 20%; left: 50%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="1"] { top: 15%; left: 35%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="2"] { top: 15%; left: 65%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="3"] { top: 25%; left: 25%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="4"] { top: 25%; left: 75%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="5"] { top: 35%; left: 15%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="6"] { top: 35%; left: 85%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="7"] { top: 70%; left: 30%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="8"] { top: 70%; left: 70%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="9"] { top: 80%; left: 50%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="10"] { top: 75%; left: 20%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="11"] { top: 75%; left: 80%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="12"] { top: 30%; left: 40%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="13"] { top: 30%; left: 60%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="14"] { top: 65%; left: 15%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="15"] { top: 65%; left: 85%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="16"] { top: 45%; left: 12%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="17"] { top: 45%; left: 88%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="18"] { top: 85%; left: 35%; transform: translate(-50%, -50%); }
        .user-profile-circle[data-position="19"] { top: 85%; left: 65%; transform: translate(-50%, -50%); }

        /* 플레이어 바 진행바 */
        .player-bar .progress .progress-filled {
            width: 0%;
            transition: width 0.2s linear;
        }

        .volume-slider {
            position: relative;
        }

        .volume-filled {
            width: 60%;
        }
    </style>
</head>
<body>
    <div class="container">
      <nav class="nav-bar">
        <a href="1_에쁠킬라_Home.html" style="text-decoration: none">
            <div class="service-name">SoundLetter</div>
        </a>
        <a href="1_에쁠킬라_Home.html" class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
          홈
        </a>
        <a href="1_에쁠킬라_Playlist.html" class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"
            />
          </svg>
          플레이리스트
        </a>
        <a href="1_에쁠킬라_PlayRecord.html" class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"
            />
          </svg>
          재생기록
        </a>
        <a href="1_에쁠킬라_TimeCapsule.html" class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"
            />
          </svg>
          타임캡슐
        </a>
        <a href="1_에쁠킬라_Map.html" class="nav-item">
          <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M480-388q54-50 84-80t47-50q16-20 22.5-37t6.5-37q0-36-26-62t-62-26q-21 0-40.5 8.5T480-648q-12-15-31-23.5t-41-8.5q-36 0-62 26t-26 62q0 21 6 37t22 36q17 20 46 50t86 81Zm0 202q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z"/></svg>
          지도
        </a>
        <a href="1_에쁠킬라_Sharing.html" class="nav-item active">
            <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M560-160q-66 0-113-47t-47-113q0-66 47-113t113-47q23 0 42.5 5.5T640-458v-342h240v120H720v360q0 66-47 113t-113 47ZM80-320q0-99 38-186.5T221-659q65-65 152.5-103T560-800v80q-82 0-155 31.5t-127.5 86q-54.5 54.5-86 127T160-320H80Zm160 0q0-66 25.5-124.5t69-102Q378-590 436-615t124-25v80q-100 0-170 70t-70 170h-80Z"/></svg>
            쉐어링
        </a>
        <a href="1_에쁠킬라_MyPage.html" class="nav-item">
          <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3">
              <path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg>
          마이페이지
        </a>
      </nav>

      <!-- 주요 내용 -->
      <main class="main-content">
        <header class="header">
          <div>
            <h1 class="page-title">쉐어링</h1>
            <p class="page-description">
                친구들과 함께 음악을 들어보세요.
            </p>
          </div>
          <div class="header-right">
            <div class="search-bar">
              <svg class="search-icon" viewBox="0 0 24 24">
                <path
                  d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                />
              </svg>
              <input type="text" placeholder="검색" />
            </div>
            <div class="user-profile" id="userProfile">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                />
              </svg>
              <div class="profile-dropdown" id="profileDropdown">
                <button class="profile-close-btn" id="closeProfile">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                  </svg>
                </button>
                <a href="1_에쁠킬라_MyPage.html" style="text-decoration: none; color: inherit;">
                  <div class="profile-nickname" id="headerProfileName">차은우님</div> 
                </a>
                <button class="logout-btn" onclick="handleLogout()">로그아웃</button>
              </div>
            </div>
          </div>
        </header>

        <div class="sharing-container">
          <!-- group_add 아이콘 버튼 (왼쪽) -->
          <button class="wifi-tethering-btn" onclick="openPopup()">
            <span class="material-symbols-outlined">group_add</span>
          </button>

          <!-- 중앙 원형 그라데이션 -->
          <div class="center-gradient-circle">
            <div class="center-gradient-text">
              <h2>함께 듣기</h2>
              <p>친구들과 음악을 공유하세요</p>
            </div>

            <!-- Sharing Place 정보 -->
            <div class="sharing-place-info" id="sharingPlaceInfo">
              <span class="sharing-place-host" id="sharingPlaceHost"></span>님의 Sharing Place
            </div>

            <!-- 사용자 프로필 표시 영역 (원 안) -->
            <div class="users-display-container" id="usersDisplay">
              <!-- 사용자들이 동적으로 추가됨 -->
            </div>
          </div>
        </div>
      </main>

      <!-- 팝업 오버레이 -->
      <div class="popup-overlay" id="popupOverlay" onclick="if(event.target === this) closePopup()">
        <div class="popup-container">
          <button class="popup-close-btn" onclick="closePopup()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
          
          <h2 class="popup-title" id="popupTitle">쉐어링</h2>

          <!-- 선택 화면 -->
          <div class="popup-choice-container" id="popupChoiceContainer">
            <button class="popup-choice-btn" onclick="showJoinScreen()">
              <div class="popup-choice-btn-title">참가하기</div>
              <div class="popup-choice-btn-desc">친구의 공유 코드나 ID를 입력하여 세션에 참가</div>
            </button>
            <button class="popup-choice-btn" onclick="showInviteScreen()">
              <div class="popup-choice-btn-title">초대하기</div>
              <div class="popup-choice-btn-desc">친구를 검색하여 내 세션에 초대</div>
            </button>
          </div>

          <!-- 참가하기 화면 -->
          <div class="popup-join-container" id="popupJoinContainer">
            <button class="popup-back-btn" onclick="showChoiceScreen()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
              </svg>
              뒤로가기
            </button>
            <div class="popup-input-group">
              <label class="popup-input-label">URL 입력</label>
              <input type="text" class="popup-input" id="joinUrlInput" placeholder="https://soundletter.com/session/...">
            </div>
            <div class="popup-input-group">
              <label class="popup-input-label">또는 호스트 사용자 ID</label>
              <input type="text" class="popup-input" id="joinIdInput" placeholder="@username">
            </div>
            <button class="popup-submit-btn" onclick="submitJoin()">참가하기</button>
          </div>

          <!-- 초대하기 화면 -->
          <div class="popup-invite-container" id="popupInviteContainer">
            <button class="popup-back-btn" onclick="showChoiceScreen()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
              </svg>
              뒤로가기
            </button>
            <div class="popup-input-group">
              <label class="popup-input-label">사용자 ID 검색</label>
              <div style="display: flex; gap: 8px;">
                <input type="text" class="popup-input" id="inviteSearchInput" placeholder="사용자 ID 입력" style="flex: 1;" oninput="searchInviteUsers()">
                <button class="popup-copy-link-btn" onclick="copyInviteLink()" title="초대 링크 복사">
                  <i class="material-icons">link</i>
                </button>
              </div>
            </div>
            <div class="popup-search-results" id="popupSearchResults">
              <!-- 검색 결과가 동적으로 추가됨 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 재생바 -->
      <div class="player-bar">
        <div class="now-playing">
          <img
            src="src/img/1_DontLookBackInAnger.jpg"
            alt="Now Playing"
            class="now-playing-image"
            id="nowPlayingImg"
          />
          <div class="now-playing-info">
            <h4 id="nowPlayingTitle">Don't Look Back in Anger</h4>
            <p id="nowPlayingArtist">Oasis</p>
          </div>
        </div>

        <div class="player-controls">
          <div class="control-buttons">
            <button class="control-btn" id="prevBtn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
              </svg>
            </button>
            <button class="control-btn play-btn" id="playBtn">
                <svg class="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"></path>
                </svg>
                <svg class="icon-pause" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                    <path d="M6 5h4v14H6zm8 0h4v14h-4z"></path>
                </svg>
            </button>
            <button class="control-btn" id="nextBtn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
              </svg>
            </button>
          </div>
          <div class="progress-bar">
            <span class="time" id="currentTime">0:00</span>
            <div class="progress">
              <div class="progress-filled" id="progressFilled"></div>
            </div>
            <span class="time" id="totalTime">3:30</span>
          </div>
        </div>

        <div class="volume-control">
          <svg
            class="volume-icon"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"
            />
          </svg>
          <div class="volume-slider">
            <div class="volume-filled"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* ==================== 전역 변수 ==================== */
      let currentUser = null;
      const MAX_USERS = 20;
      let currentUsers = [];
      
      // 샘플 사용자 데이터
      const sampleUsers = [
        { id: 'ahsy_u', name: '소윤' },
        { id: 'byeonwooseok', name: '변우석' },
        { id: 'chuuo3o', name: '김지우' },
        { id: 'd.o.hkyungsoo', name: '도경수' },
        { id: 'eunwo.o_c', name: '차은우' },
        { id: 'faker', name: '이상혁' },
        { id: 'gyuuujin', name: '규진' },
        { id: 'ha._.noory', name: '주하늘' },
        { id: 'iam_noonsong', name: '눈송이' },
        { id: 'jungkook', name: '정국' },
        { id: 'kwonttotto', name: '권또또' },
        { id: 'loeweruby', name: '김지민' },
        { id: 'moonjiwonn_', name: '' },
        { id: 'na_onion', name: '박나언' },
        { id: 'o.eann', name: '이안' },
        { id: 'parkseojun', name: '박서준' },
        { id: 'queen.chu_s', name: '이미주' },
        { id: 'raireyoung', name: '홍지영' },
        { id: 'song_d', name: '송은석' },
        { id: 'taeyeon_ss', name: '김태연' },
        { id: 'uuuuuuu_haru', name: '하루' },
        { id: 'v', name: '김태형' },
        { id: 'woozico', name: '우지호' },
        { id: 'xeesoxee', name: '한소희' },
        { id: 'y_eunniii', name: '지예은' },
        { id: 'zinooo', name: '이진우' }
      ];

      /* ==================== 현재 재생 중인 곡 카드 업데이트 ==================== */
      function updateNowPlayingCard() {
        const cardAlbumImage = document.getElementById('cardAlbumImage');
        const cardTrackTitle = document.getElementById('cardTrackTitle');
        const cardTrackArtist = document.getElementById('cardTrackArtist');
        const cardProgressBar = document.getElementById('cardProgressBar');
        
        if (!cardAlbumImage || !cardTrackTitle || !cardTrackArtist || !cardProgressBar) return;
        
        const currentTrack = playableTracks[currentTrackIndex];
        
        // 카드 정보 업데이트
        cardAlbumImage.src = currentTrack.image;
        cardTrackTitle.textContent = currentTrack.title;
        cardTrackArtist.textContent = currentTrack.artist;
        
        // 진행률 업데이트
        const progress = (currentTime / totalDuration) * 100;
        cardProgressBar.style.width = `${progress}%`;
      }

      /* ==================== 재생바 관련 (PlayRecord와 동일) ==================== */
      const playableTracks = [
        { title: "Don't Look Back In Anger", artist: "Oasis", image: "src/img/1_DontLookBackInAnger.jpg" },
        { title: "좋은 밤 좋은 꿈", artist: "SG 워너비", image: "src/img/1_좋은밤좋은꿈.jpg" },
        { title: "에피소드", artist: "이무진", image: "src/img/1_에피소드.jpg" },
        { title: "Trip", artist: "릴러말즈 (Feat. Hannah)", image: "src/img/1_Trip.jpg" },
        { title: "How Sweet", artist: "NewJeans", image: "src/img/1_howsweet.png" },
        { title: "한 페이지가 될 수 있게", artist: "Day6", image: "src/img/1_한페이지가될수있게_.jpg" },
        { title: "Get Up", artist: "NewJeans", image: "src/img/1_GETUP.jpg" },
        { title: "꿈의 버스", artist: "Day6", image: "src/img/1_꿈의버스.jpg" },
        { title: "Please Please Please", artist: "Sabrina Carpenter", image: "src/img/1_please.png" },
        { title: "ETA", artist: "NewJeans", image: "src/img/1_GETUP.jpg" },
        { title: "사랑", artist: "최유리", image: "src/img/1_사랑.jpg" },
        { title: "Leave Before You Love Me", artist: "Marshmello, Jonas Brothers", image: "src/img/1_LeaveBeforeYouLoveMe.jpg" },
        { title: "Love Wins All", artist: "IU", image: "src/img/1_lovewinsall.png" },
        { title: "Siren", artist: "RIIZE", image: "src/img/1_siren.png" },
        { title: "Lose My Mind", artist: "Don Toliver (feat. Doja Cat)", image: "src/img/1_Lose_My_Mind.jpg" },
        { title: "비 오는 날 듣기 좋은 노래", artist: "에픽하이 (Feat. Colde)", image: "src/img/1_비오는날에듣기좋은노래.jpg" },
        { title: "Cool With You", artist: "NewJeans", image: "src/img/1_GETUP.jpg" },
        { title: "Smart", artist: "LE SSERAFIM", image: "src/img/1_smart.png" },
        { title: "Cruel Summer", artist: "Taylor Swift", image: "src/img/1_lover.jpg" },
        { title: "눈사람", artist: "아티스트", image: "src/img/1_눈사람.jpg" },
        { title: "Super Shy", artist: "NewJeans", image: "src/img/1_GETUP.jpg" },
        { title: "Love on the Canvas", artist: "소희", image: "src/img/1_Love_on_the_canvas.jpg" },
        { title: "Supernova", artist: "aespa", image: "src/img/1_supernova.png" },
        { title: "너에게 못했던 내 마지막 말은", artist: "다비치", image: "src/img/1_너에게못했던내마지막말은.jpg" },
        { title: "Celebrity", artist: "IU", image: "src/img/1_celebrity.png" },
        { title: "Bubble Gum", artist: "NewJeans", image: "src/img/1_howsweet.png" },
        { title: "NewJeans", artist: "NewJeans", image: "src/img/1_GETUP.jpg" },
        { title: "Tell Us Bout Yourself", artist: "백예린", image: "src/img/1_tellusboutyourself.jpg" },
        { title: "We Don't Talk Anymore", artist: "Charlie Puth", image: "src/img/1_we.png" },
        { title: "Youth", artist: "다섯", image: "src/img/1_Youth.jpg" },
        { title: "Kill Bill", artist: "SZA", image: "src/img/1_SOS.jpg" },
        { title: "ASAP", artist: "NewJeans", image: "src/img/1_GETUP.jpg" }
      ];

      let currentIndex = 0;
      let isPlaying = false;
      let currentTime = 0;
      const totalDuration = 210;
      let playTimer = null;

      const nowPlayingImg = document.getElementById('nowPlayingImg');
      const nowPlayingTitle = document.getElementById('nowPlayingTitle');
      const nowPlayingArtist = document.getElementById('nowPlayingArtist');
      const playBtn = document.getElementById('playBtn');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const iconPlay = document.querySelector('.icon-play');
      const iconPause = document.querySelector('.icon-pause');
      const progressFilled = document.getElementById('progressFilled');
      const currentTimeSpan = document.getElementById('currentTime');
      const totalTimeSpan = document.getElementById('totalTime');

      function formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return m + ':' + (s < 10 ? '0' : '') + s;
      }

      function updateProgress() {
        const percent = (currentTime / totalDuration) * 100;
        progressFilled.style.width = Math.min(percent, 100) + '%';
        currentTimeSpan.textContent = formatTime(currentTime);
        
        // 카드 진행률도 업데이트
        const cardProgressBar = document.getElementById('cardProgressBar');
        if (cardProgressBar) {
          cardProgressBar.style.width = Math.min(percent, 100) + '%';
        }
      }

      function startPlayTimer() {
        if (playTimer) clearInterval(playTimer);
        playTimer = setInterval(() => {
          if (!isPlaying) return;
          currentTime += 0.5;
          if (currentTime >= totalDuration) {
            currentTime = totalDuration;
            updateProgress();
            nextTrack();
            return;
          }
          updateProgress();
        }, 500);
      }

      function play() {
        if (playableTracks.length === 0) return;
        if (currentIndex === -1) {
          selectTrack(0);
        }
        isPlaying = true;
        iconPlay.style.display = 'none';
        iconPause.style.display = 'inline';
        startPlayTimer();
      }

      function pause() {
        isPlaying = false;
        iconPlay.style.display = 'inline';
        iconPause.style.display = 'none';
        if (playTimer) clearInterval(playTimer);
      }

      function selectTrack(index) {
        if (index < 0 || index >= playableTracks.length) return;
        currentIndex = index;
        const track = playableTracks[index];

        nowPlayingImg.src = track.image;
        nowPlayingImg.alt = track.title;
        nowPlayingTitle.textContent = track.title;
        nowPlayingArtist.textContent = track.artist || '';

        currentTime = 0;
        updateProgress();
        updateNowPlayingCard(); // 카드 업데이트 추가
        play();
      }

      function prevTrack() {
        if (playableTracks.length === 0) return;
        const nextIndex = (currentIndex - 1 + playableTracks.length) % playableTracks.length;
        selectTrack(nextIndex);
      }

      function nextTrack() {
        if (playableTracks.length === 0) return;
        const nextIndex = (currentIndex + 1) % playableTracks.length;
        selectTrack(nextIndex);
      }

      playBtn.addEventListener('click', () => {
        if (!isPlaying) {
          play();
        } else {
          pause();
        }
      });

      prevBtn.addEventListener('click', () => {
        prevTrack();
      });

      nextBtn.addEventListener('click', () => {
        nextTrack();
      });

      currentTimeSpan.textContent = formatTime(0);
      totalTimeSpan.textContent = '3:30';

      /* ==================== 프로필 드롭다운 ==================== */
      const userProfile = document.getElementById("userProfile");
      const profileDropdown = document.getElementById("profileDropdown");
      const closeProfile = document.getElementById("closeProfile");

      userProfile.addEventListener("click", (e) => {
        e.stopPropagation();
        profileDropdown.classList.toggle("active");
      });

      closeProfile.addEventListener("click", (e) => {
        e.stopPropagation();
        profileDropdown.classList.remove("active");
      });

      document.addEventListener("click", () => {
        profileDropdown.classList.remove("active");
      });

      function handleLogout() {
        alert("로그아웃 되었습니다!");
        window.location.href = "1_에쁠킬라_Login.html";
      }

      /* ==================== 로그인 체크 ==================== */
      (function checkLogin() {
        const loggedInUser = sessionStorage.getItem('loggedInUser');

        if (!loggedInUser) {
          alert('로그인이 필요한 서비스입니다.');
          window.location.href = '1_에쁠킬라_Login.html';
        } else {
          const user = JSON.parse(loggedInUser);
          currentUser = user;
          
          const profileNickname = document.querySelector('.profile-nickname');
          if (profileNickname) {
            profileNickname.innerHTML = user.name + '님';
          }
          
          // 본인 이름으로 Sharing Place 표시
          const sharingPlaceInfo = document.getElementById('sharingPlaceInfo');
          const sharingPlaceHost = document.getElementById('sharingPlaceHost');
          if (sharingPlaceHost) sharingPlaceHost.textContent = user.name;
          if (sharingPlaceInfo) sharingPlaceInfo.classList.add('active');
          
          // DOM이 완전히 로드된 후 사용자 추가
          setTimeout(() => {
            console.log('로그인 사용자 추가:', user.name);
            addUser(user.name, true);
          }, 100);
        }
      })();

      /* ==================== 팝업 관리 ==================== */
      function openPopup() {
        const popupOverlay = document.getElementById('popupOverlay');
        popupOverlay.classList.add('active');
        showChoiceScreen();
      }

      function closePopup() {
        const popupOverlay = document.getElementById('popupOverlay');
        popupOverlay.classList.remove('active');
        setTimeout(() => {
          showChoiceScreen();
          const joinUrlInput = document.getElementById('joinUrlInput');
          const joinIdInput = document.getElementById('joinIdInput');
          const inviteSearchInput = document.getElementById('inviteSearchInput');
          const popupSearchResults = document.getElementById('popupSearchResults');
          if (joinUrlInput) joinUrlInput.value = '';
          if (joinIdInput) joinIdInput.value = '';
          if (inviteSearchInput) inviteSearchInput.value = '';
          if (popupSearchResults) popupSearchResults.innerHTML = '';
        }, 300);
      }

      function showChoiceScreen() {
        const popupTitle = document.getElementById('popupTitle');
        const popupChoiceContainer = document.getElementById('popupChoiceContainer');
        const popupJoinContainer = document.getElementById('popupJoinContainer');
        const popupInviteContainer = document.getElementById('popupInviteContainer');
        
        if (popupTitle) popupTitle.textContent = '쉐어링';
        if (popupChoiceContainer) popupChoiceContainer.classList.remove('hidden');
        if (popupJoinContainer) popupJoinContainer.classList.remove('active');
        if (popupInviteContainer) popupInviteContainer.classList.remove('active');
      }

      function showJoinScreen() {
        const popupTitle = document.getElementById('popupTitle');
        const popupChoiceContainer = document.getElementById('popupChoiceContainer');
        const popupJoinContainer = document.getElementById('popupJoinContainer');
        const popupInviteContainer = document.getElementById('popupInviteContainer');
        const joinUrlInput = document.getElementById('joinUrlInput');
        
        if (popupTitle) popupTitle.textContent = '참가하기';
        if (popupChoiceContainer) popupChoiceContainer.classList.add('hidden');
        if (popupJoinContainer) popupJoinContainer.classList.add('active');
        if (popupInviteContainer) popupInviteContainer.classList.remove('active');
        setTimeout(() => { if (joinUrlInput) joinUrlInput.focus(); }, 100);
      }

      function showInviteScreen() {
        const popupTitle = document.getElementById('popupTitle');
        const popupChoiceContainer = document.getElementById('popupChoiceContainer');
        const popupJoinContainer = document.getElementById('popupJoinContainer');
        const popupInviteContainer = document.getElementById('popupInviteContainer');
        const inviteSearchInput = document.getElementById('inviteSearchInput');
        
        if (popupTitle) popupTitle.textContent = '초대하기';
        if (popupChoiceContainer) popupChoiceContainer.classList.add('hidden');
        if (popupJoinContainer) popupJoinContainer.classList.remove('active');
        if (popupInviteContainer) popupInviteContainer.classList.add('active');
        setTimeout(() => { if (inviteSearchInput) inviteSearchInput.focus(); }, 100);
      }

      function submitJoin() {
        const joinUrlInput = document.getElementById('joinUrlInput');
        const joinIdInput = document.getElementById('joinIdInput');
        const urlValue = joinUrlInput ? joinUrlInput.value.trim() : '';
        const idValue = joinIdInput ? joinIdInput.value.trim() : '';
        
        if (!urlValue && !idValue) {
          alert('URL 또는 호스트 사용자 ID를 입력하세요.');
          return;
        }
        
        let hostName = '';
        if (urlValue) {
          // URL에서 호스트 이름 추출 (예시)
          hostName = '호스트';
        } else {
          // ID에서 @ 제거
          hostName = idValue.replace('@', '');
        }
        
        // Sharing Place 정보 표시
        const sharingPlaceInfo = document.getElementById('sharingPlaceInfo');
        const sharingPlaceHost = document.getElementById('sharingPlaceHost');
        if (sharingPlaceHost) sharingPlaceHost.textContent = hostName;
        if (sharingPlaceInfo) sharingPlaceInfo.classList.add('active');
        
        closePopup();
      }

      function copyInviteLink() {
        // 실제로는 서버에서 생성된 URL을 사용해야 함
        const inviteUrl = `https://soundletter.com/share/${Math.random().toString(36).substring(7)}`;
        
        // 클립보드에 복사
        navigator.clipboard.writeText(inviteUrl).then(() => {
          alert('URL이 복사되었습니다!');
        }).catch(() => {
          // 구형 브라우저 대응
          const textarea = document.createElement('textarea');
          textarea.value = inviteUrl;
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          alert('URL이 복사되었습니다!');
        });
      }

      function searchInviteUsers() {
        const inviteSearchInput = document.getElementById('inviteSearchInput');
        const popupSearchResults = document.getElementById('popupSearchResults');
        const searchTerm = inviteSearchInput ? inviteSearchInput.value.toLowerCase().trim() : '';
        
        if (searchTerm.length === 0) {
          if (popupSearchResults) popupSearchResults.innerHTML = '';
          return;
        }

        const filtered = sampleUsers.filter(user => 
          (user.id.toLowerCase().includes(searchTerm) || user.name.includes(searchTerm)) &&
          !currentUsers.some(cu => cu.name === user.name)
        );

        if (filtered.length > 0 && popupSearchResults) {
          popupSearchResults.innerHTML = filtered.map(user => `
            <div class="popup-user-item">
              <div class="popup-user-avatar">
                <svg viewBox="0 0 24 24">
                  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
              </div>
              <div class="popup-user-name">${user.name} (@${user.id})</div>
              <button class="popup-add-btn" onclick="addUserFromPopup('${user.name}')">초대</button>
            </div>
          `).join('');
        } else if (popupSearchResults) {
          popupSearchResults.innerHTML = '<div style="padding: 20px; text-align: center; color: #b3b3b3;">검색 결과가 없습니다.</div>';
        }
      }

      /* ==================== 쉐어링 기능 ==================== */
      let usersDisplay = null;
      
      // DOM 로드 후 usersDisplay 초기화
      document.addEventListener('DOMContentLoaded', function() {
        usersDisplay = document.getElementById('usersDisplay');
        console.log('DOMContentLoaded - usersDisplay:', usersDisplay);
      });
      
      // 즉시 초기화도 시도
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          usersDisplay = document.getElementById('usersDisplay');
        });
      } else {
        usersDisplay = document.getElementById('usersDisplay');
      }

      function addUser(userName, isCurrentUser = false) {
        if (currentUsers.length >= MAX_USERS) {
          alert('최대 20명까지만 추가할 수 있습니다.');
          return false;
        }

        if (currentUsers.some(user => user.name === userName)) {
          if (!isCurrentUser) {
            return false; // 이미 추가된 사용자
          }
          return false;
        }

        currentUsers.push({ name: userName, isCurrentUser });
        renderUsers();

        return true; // 성공
      }

      function removeUser(userName) {
        currentUsers = currentUsers.filter(user => user.name !== userName);
        renderUsers();
      }

      function renderUsers() {
        console.log('renderUsers 호출됨');
        console.log('currentUsers:', currentUsers);
        console.log('usersDisplay:', usersDisplay);
        
        if (!usersDisplay) {
          console.error('usersDisplay 요소를 찾을 수 없음!');
          return;
        }
        
        usersDisplay.innerHTML = '';

        currentUsers.forEach((user, index) => {
          console.log(`사용자 ${index} 렌더링:`, user.name);
          
          const userCircle = document.createElement('div');
          userCircle.className = 'user-profile-circle';
          userCircle.setAttribute('data-position', index);
          
          userCircle.innerHTML = `
            <div class="user-profile-avatar">
              <img src="src/img/1_profile.png" alt="${user.name}" 
                   style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
            </div>
            <div class="user-profile-name">${user.name}</div>
            ${!user.isCurrentUser ? `
              <div class="user-profile-remove" onclick="removeUser('${user.name}')">
                <svg viewBox="0 0 24 24">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </div>
            ` : ''}
          `;

          usersDisplay.appendChild(userCircle);
          console.log(`사용자 ${index} DOM 추가 완료`);
        });
        
        console.log('renderUsers 완료, 총 사용자 수:', currentUsers.length);
        console.log('usersDisplay.children.length:', usersDisplay.children.length);
      }

      function addUserFromPopup(userName) {
        console.log('addUserFromPopup 호출:', userName);
        console.log('현재 사용자 목록:', currentUsers);
        
        // 이미 추가된 사용자인지 먼저 확인
        if (currentUsers.some(user => user.name === userName)) {
          alert(`${userName}님은 이미 초대된 사용자입니다.`);
          return;
        }
        
        // 사용자 추가
        const success = addUser(userName, false);
        console.log('addUser 결과:', success);
        
        if (success) {
          alert(`${userName}님을 초대했습니다!`);
          closePopup();
        } else {
          alert('초대에 실패했습니다.');
        }
      }

      // 전역으로 명시적 할당
      window.addUserFromPopup = addUserFromPopup;

      renderUsers();
    </script>
</body>
</html>