<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoundLetter - 재생기록</title>
    <link rel="stylesheet" href="../css/1_에쁠킬라_layout.css" />
    <link rel="icon" type="image/svg+xml" href="../favicon.svg?v=2">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=calendar_month" />

    <style>
        .page-title {
            font-size: 32px;
            font-weight: 700;
        }

        .main-content {
            padding: 24px 32px 110px 32px !important;
        }

        /* 사용자 프로필 드롭다운 */
        .user-profile {
            position: relative;
            cursor: pointer;
            z-index: 100000;
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + 12px);
            right: 0;
            background: #282828;
            border-radius: 12px;
            padding: 20px;
            min-width: 200px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 100000;
        }

        .profile-close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #b3b3b3;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
            z-index: 100000;
        }

        .profile-close-btn:hover {
            color: #ffffff;
        }

        .profile-nickname {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 16px;
            padding-right: 24px;
        }

        .logout-btn {
            width: 100%;
            padding: 10px 16px;
            background: #ff9500;
            color: #000000;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #ffaa00;
            transform: translateY(-1px);
        }

        .record-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .record-tab {
            background: none;
            border: none;
            color: #b3b3b3;
            font-size: 15px;
            font-weight: 600;
            padding-bottom: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .record-tab.active {
            color: #ff9500;
            border-bottom: 2px solid #ff9500;
        }

        .calendar-sort-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 24px;
        }

        .filter-btn,
        .sort-select {
            background: #282828;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-btn .material-symbols-outlined {
            font-size: 20px;
        }

        .filter-btn:hover,
        .sort-select:hover {
            background: #3a3a3a;
        }

        .record-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .record-item {
            display: flex;
            align-items: center;
            background: #282828;
            border-radius: 12px;
            padding: 12px 16px;
            transition: 0.3s;
            cursor: pointer;
            position: relative;
        }

        .record-item:hover {
            background: #3c3c3c;
        }

        .record-thumb {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 14px;
            flex-shrink: 0;
        }

        .record-info {
            flex: 1;
            min-width: 0;
        }

        .record-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .record-info p {
            font-size: 13px;
            color: #b3b3b3;
        }

        .record-play-btn {
            width: 40px;
            height: 40px;
            background: #ff9500;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0;
            flex-shrink: 0;
            margin-left: 12px;
        }

        .record-item:hover .record-play-btn {
            opacity: 1;
        }

        .record-play-btn svg {
            width: 18px;
            height: 18px;
            margin-left: 2px;
        }

        .record-play-btn .icon-play {
            display: block;
        }

        .record-play-btn .icon-pause {
            display: none;
        }

        .record-item.playing .record-play-btn {
            opacity: 1;
        }

        .record-item.playing .record-play-btn .icon-play {
            display: none;
        }

        .record-item.playing .record-play-btn .icon-pause {
            display: block;
        }

        /* 플레이어 바 진행바 */
        .player-bar .progress .progress-filled {
            width: 0%;
            transition: width 0.2s linear;
        }
    </style>
</head>

<body>
    <div class="container">
        <nav class="nav-bar">
            <a href="1_에쁠킬라_Home.html" style="text-decoration: none;">
                <div class="service-name">SoundLetter</div>
            </a>
            <a href="1_에쁠킬라_Home.html" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                홈
            </a>
            <a href="1_에쁠킬라_Playlist.html" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
                </svg>
                플레이리스트
            </a>
            <a href="1_에쁠킬라_PlayRecord.html" class="nav-item active">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
                재생기록
            </a>
            <a href="1_에쁠킬라_TimeCapsule.html" class="nav-item">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
                </svg>
                타임캡슐
            </a>
            <a href="1_에쁠킬라_Map.html" class="nav-item">
                <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                    <path d="M480-388q54-50 84-80t47-50q16-20 22.5-37t6.5-37q0-36-26-62t-62-26q-21 0-40.5 8.5T480-648q-12-15-31-23.5t-41-8.5q-36 0-62 26t-26 62q0 21 6 37t22 36q17 20 46 50t86 81Zm0 202q122-112 181-203.5T720-552q0-109-69.5-178.5T480-800q-101 0-170.5 69.5T240-552q0 71 59 162.5T480-186Zm0 106Q319-217 239.5-334.5T160-552q0-150 96.5-239T480-880q127 0 223.5 89T800-552q0 100-79.5 217.5T480-80Zm0-480Z"/>
                </svg>
                지도
            </a>
            <a href="1_에쁠킬라_Sharing.html" class="nav-item">
                <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                    <path d="M560-160q-66 0-113-47t-47-113q0-66 47-113t113-47q23 0 42.5 5.5T640-458v-342h240v120H720v360q0 66-47 113t-113 47ZM80-320q0-99 38-186.5T221-659q65-65 152.5-103T560-800v80q-82 0-155 31.5t-127.5 86q-54.5 54.5-86 127T160-320H80Zm160 0q0-66 25.5-124.5t69-102Q378-590 436-615t124-25v80q-100 0-170 70t-70 170h-80Z"/>
                </svg>
                쉐어링
            </a>
            <a href="1_에쁠킬라_MyPage.html" class="nav-item">
                <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
                    <path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/>
                </svg>
                마이페이지
            </a>
        </nav>

        <main class="main-content">
            <header class="header">
                <div>
                    <h1 class="page-title">재생기록</h1>
                </div>

                <div class="header-right">
                    <div class="search-bar">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 
                            16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 
                            9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 
                            4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 
                            5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 
                            11.99 14 9.5 14z"/>
                        </svg>
                        <input type="text" placeholder="검색">
                    </div>

                    <div class="user-profile">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4
                            -4 1.79-4 4 1.79 4 4 4zm0 2
                            c-2.67 0-8 1.34-8 4v2h16v-2
                            c0-2.66-5.33-4-8-4z"/>
                        </svg>

                        <div class="profile-dropdown" style="display: none;">
                            <button class="profile-close-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 6.41L17.59 5 12 10.59 
                                    6.41 5 5 6.41 10.59 12 5 17.59 
                                    6.41 19 12 13.41 17.59 19 
                                    19 17.59 13.41 12z"/>
                                </svg>
                            </button>
                            <div class="profile-nickname">차은우님</div>
                            <button class="logout-btn">로그아웃</button>
                        </div>
                    </div>
                </div>
            </header>


            <div class="calendar-sort-group">
                <button class="filter-btn">
                    <span class="material-symbols-outlined">calendar_month</span>
                </button>
                <select class="sort-select" id="sortSelect">
                    <option value="playcount">정렬: 많이 들은 순</option>
                    <option value="recent">정렬: 최근 들은 순</option>
                    <option value="added">정렬: 최근 추가된 순</option>
                    <option value="alphabetical">정렬: 가나다순</option>
                </select>
            </div>

            <div class="record-tabs">
                <button class="record-tab active" data-period="today">오늘</button>
                <button class="record-tab" data-period="week">이번 주</button>
                <button class="record-tab" data-period="month">이번 달</button>
            </div>

            <div class="record-list" id="recordList"></div>
        </main>
    </div>

    <div class="player-bar">
        <div class="now-playing">
            <img src="src/img/1_DontLookBackInAnger.jpg" alt="Now Playing" class="now-playing-image">
            <div class="now-playing-info">
                <h4 class="now-playing-title">Don't Look Back in Anger</h4>
                <p class="now-playing-artist">Oasis</p>
            </div>
        </div>

        <div class="player-controls">
            <div class="control-buttons">
                <button class="control-btn prev-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                    </svg>
                </button>
                <button class="control-btn play-btn">
                    <svg class="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg class="icon-pause" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                        <path d="M6 5h4v14H6zm8 0h4v14h-4z"/>
                    </svg>
                </button>
                <button class="control-btn next-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
                    </svg>
                </button>
            </div>
            <div class="progress-bar">
                <span class="time current-time">0:00</span>
                <div class="progress">
                    <div class="progress-filled"></div>
                </div>
                <span class="time total-time">3:30</span>
            </div>
        </div>

        <div class="volume-control">
            <svg class="volume-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
            </svg>
            <div class="volume-slider">
                <div class="volume-filled"></div>
            </div>
        </div>
    </div>

    <script>
        // 전체 노래 데이터
        const allSongs = [
            { title: "Don't Look Back In Anger", artist: "Oasis", image: "src/img/1_DontLookBackInAnger.jpg", playCount: 43, lastPlayed: new Date('2025-12-02'), addedDate: new Date('2025-11-05') },
            { title: "좋은 밤 좋은 꿈", artist: "SG 워너비", image: "src/img/1_좋은밤좋은꿈.jpg", playCount: 60, lastPlayed: new Date('2025-12-02'), addedDate: new Date('2025-11-05') },
            { title: "에피소드", artist: "이무진", image: "src/img/1_에피소드.jpg", playCount: 102, lastPlayed: new Date('2025-12-01'), addedDate: new Date('2025-11-05') },
            { title: "Trip", artist: "릴러말즈 (Feat. Hannah)", image: "src/img/1_Trip.jpg", playCount: 13, lastPlayed: new Date('2025-12-01'), addedDate: new Date('2025-08-15') },
            { title: "How Sweet", artist: "NewJeans", image: "src/img/1_howsweet.png", playCount: 43, lastPlayed: new Date('2025-12-01'), addedDate: new Date('2025-10-05') },
            { title: "한 페이지가 될 수 있게", artist: "Day6", image: "src/img/1_한페이지가될수있게_.jpg", playCount: 80, lastPlayed: new Date('2025-12-01'), addedDate: new Date('2025-11-05') },
            { title: "Get Up", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 44, lastPlayed: new Date('2025-11-30'), addedDate: new Date('2025-07-15') },
            { title: "꿈의 버스", artist: "Day6", image: "src/img/1_꿈의버스.jpg", playCount: 55, lastPlayed: new Date('2025-11-30'), addedDate: new Date('2024-08-10') },
            { title: "Please Please Please", artist: "Sabrina Carpenter", image: "src/img/1_please.png", playCount: 29, lastPlayed: new Date('2025-11-29'), addedDate: new Date('2025-09-28') },
            { title: "ETA", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 88, lastPlayed: new Date('2025-11-29'), addedDate: new Date('2025-07-15') },
            { title: "사랑", artist: "최유리", image: "src/img/1_사랑.jpg", playCount: 52, lastPlayed: new Date('2025-11-28'), addedDate: new Date('2025-11-05') },
            { title: "Leave Before You Love Me", artist: "Marshmello, Jonas Brothers", image: "src/img/1_LeaveBeforeYouLoveMe.jpg", playCount: 28, lastPlayed: new Date('2025-11-27'), addedDate: new Date('2025-10-25') },
            { title: "Love Wins All", artist: "IU", image: "src/img/1_lovewinsall.png", playCount: 31, lastPlayed: new Date('2025-11-27'), addedDate: new Date('2025-09-25') },
            { title: "Siren", artist: "RIIZE", image: "src/img/1_siren.png", playCount: 33, lastPlayed: new Date('2025-11-26'), addedDate: new Date('2025-10-05') },
            { title: "Lose My Mind", artist: "Don Toliver (feat. Doja Cat)", image: "src/img/1_Lose_My_Mind.jpg", playCount: 28, lastPlayed: new Date('2025-11-26'), addedDate: new Date('2025-10-25') },
            { title: "비 오는 날 듣기 좋은 노래", artist: "에픽하이 (Feat. Colde)", image: "src/img/1_비오는날에듣기좋은노래.jpg", playCount: 43, lastPlayed: new Date('2025-11-25'), addedDate: new Date('2025-11-05') },
            { title: "Cool With You", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 34, lastPlayed: new Date('2025-11-25'), addedDate: new Date('2025-07-15') },
            { title: "Smart", artist: "LE SSERAFIM", image: "src/img/1_smart.png", playCount: 36, lastPlayed: new Date('2025-11-24'), addedDate: new Date('2025-10-08') },
            { title: "Cruel Summer", artist: "Taylor Swift", image: "src/img/1_lover.jpg", playCount: 39, lastPlayed: new Date('2025-11-24'), addedDate: new Date('2025-07-25') },
            { title: "눈사람", artist: "아티스트", image: "src/img/1_눈사람.jpg", playCount: 19, lastPlayed: new Date('2025-11-23'), addedDate: new Date('2025-10-20') },
            { title: "Super Shy", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 45, lastPlayed: new Date('2025-11-23'), addedDate: new Date('2025-07-15') },
            { title: "Love on the Canvas", artist: "소희", image: "src/img/1_Love_on_the_canvas.jpg", playCount: 12, lastPlayed: new Date('2025-11-22'), addedDate: new Date('2025-08-10') },
            { title: "Supernova", artist: "aespa", image: "src/img/1_supernova.png", playCount: 41, lastPlayed: new Date('2025-11-21'), addedDate: new Date('2025-11-03') },
            { title: "너에게 못했던 내 마지막 말은", artist: "다비치", image: "src/img/1_너에게못했던내마지막말은.jpg", playCount: 12, lastPlayed: new Date('2025-11-20'), addedDate: new Date('2025-11-05') },
            { title: "Celebrity", artist: "IU", image: "src/img/1_celebrity.png", playCount: 34, lastPlayed: new Date('2025-11-19'), addedDate: new Date('2025-07-20') },
            { title: "Bubble Gum", artist: "NewJeans", image: "src/img/1_howsweet.png", playCount: 63, lastPlayed: new Date('2025-11-18'), addedDate: new Date('2025-10-05') },
            { title: "NewJeans", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 10, lastPlayed: new Date('2025-11-17'), addedDate: new Date('2025-07-15') },
            { title: "Tell Us Bout Yourself", artist: "백예린", image: "src/img/1_tellusboutyourself.jpg", playCount: 15, lastPlayed: new Date('2025-11-16'), addedDate: new Date('2025-10-12') },
            { title: "We Don't Talk Anymore", artist: "Charlie Puth", image: "src/img/1_we.png", playCount: 16, lastPlayed: new Date('2025-11-15'), addedDate: new Date('2025-10-15') },
            { title: "Youth", artist: "다섯", image: "src/img/1_Youth.jpg", playCount: 24, lastPlayed: new Date('2025-11-14'), addedDate: new Date('2025-08-20') },
            { title: "Kill Bill", artist: "SZA", image: "src/img/1_SOS.jpg", playCount: 18, lastPlayed: new Date('2025-11-13'), addedDate: new Date('2025-10-25') },
            { title: "ASAP", artist: "NewJeans", image: "src/img/1_GETUP.jpg", playCount: 48, lastPlayed: new Date('2025-11-12'), addedDate: new Date('2025-07-15') },
        ];

        // 플레이어 큐
        let playerQueue = [...allSongs];
        let currentIndex = 0;
        let isPlaying = false;
        let currentTime = 0;
        const totalDuration = 210;
        let playTimer = null;
        let currentPlayingSong = null; // 현재 재생 중인 곡 추적

        // DOM 요소
        const nowPlayingImg = document.querySelector('.now-playing-image');
        const nowPlayingTitle = document.querySelector('.now-playing-title');
        const nowPlayingArtist = document.querySelector('.now-playing-artist');
        const progressFilled = document.querySelector('.progress-filled');
        const currentTimeSpan = document.querySelector('.current-time');
        const prevBtn = document.querySelector('.prev-btn');
        const playBtn = document.querySelector('.play-btn');
        const nextBtn = document.querySelector('.next-btn');
        const iconPlay = document.querySelector('.icon-play');
        const iconPause = document.querySelector('.icon-pause');

        // 시간 포맷
        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = Math.floor(sec % 60);
            return m + ':' + (s < 10 ? '0' + s : s);
        }

        // 진행바 업데이트
        function updateProgress() {
            const percent = (currentTime / totalDuration) * 100;
            progressFilled.style.width = Math.min(percent, 100) + '%';
            currentTimeSpan.textContent = formatTime(currentTime);
        }

        // 재생 타이머
        function startPlayTimer() {
            if (playTimer) clearInterval(playTimer);
            playTimer = setInterval(() => {
                if (!isPlaying) return;
                currentTime += 0.5;
                if (currentTime >= totalDuration) {
                    currentTime = totalDuration;
                    updateProgress();
                    pause();
                    return;
                }
                updateProgress();
            }, 500);
        }

        function play() {
            if (currentIndex === -1 && playerQueue.length > 0) {
                selectTrack(0);
            }
            isPlaying = true;
            iconPlay.style.display = 'none';
            iconPause.style.display = 'inline';
            startPlayTimer();
            
            // record-item 아이콘 업데이트
            updateRecordItemIcons();
        }

        function pause() {
            isPlaying = false;
            iconPlay.style.display = 'inline';
            iconPause.style.display = 'none';
            if (playTimer) clearInterval(playTimer);
            
            // record-item 아이콘 업데이트
            updateRecordItemIcons();
        }

        function updateRecordItemIcons() {
            document.querySelectorAll('.record-item').forEach(item => {
                const itemTitle = item.querySelector('.record-info h3').textContent;
                if (currentPlayingSong && itemTitle === currentPlayingSong.title) {
                    if (isPlaying) {
                        item.classList.add('playing');
                    } else {
                        item.classList.remove('playing');
                    }
                } else {
                    item.classList.remove('playing');
                }
            });
        }

        function selectTrack(index) {
            if (index < 0 || index >= playerQueue.length) return;
            currentIndex = index;
            const track = playerQueue[index];
            currentPlayingSong = track; // 현재 재생 중인 곡 저장

            nowPlayingImg.src = track.image;
            nowPlayingImg.alt = track.title;
            nowPlayingTitle.textContent = track.title;
            nowPlayingArtist.textContent = track.artist || '';

            currentTime = 0;
            updateProgress();
            play();
        }

        function prevTrack() {
            if (playerQueue.length === 0) return;
            const nextIndex = (currentIndex - 1 + playerQueue.length) % playerQueue.length;
            selectTrack(nextIndex);
        }

        function nextTrack() {
            if (playerQueue.length === 0) return;
            const nextIndex = (currentIndex + 1) % playerQueue.length;
            selectTrack(nextIndex);
        }

        // 필터링 및 정렬 함수
        function filterByPeriod(songs, period) {
            if (period === 'today') {
                return songs.slice(0, 12);
            } else if (period === 'week') {
                return songs.slice(0, 21);
            } else if (period === 'month') {
                return songs.slice(0, 34);
            }
            return songs;
        }

        function sortSongs(songs, sortType) {
            const sorted = [...songs];
            
            if (sortType === 'playcount') {
                // 많이 들은 순
                return sorted.sort((a, b) => b.playCount - a.playCount);
            } else if (sortType === 'recent') {
                // 최근 들은 순
                return sorted.sort((a, b) => b.lastPlayed - a.lastPlayed);
            } else if (sortType === 'added') {
                // 최근 추가된 순
                return sorted.sort((a, b) => b.addedDate - a.addedDate);
            } else if (sortType === 'alphabetical') {
                // 가나다순
                return sorted.sort((a, b) => a.title.localeCompare(b.title, 'ko'));
            }
            return sorted;
        }

        // 재생기록 렌더링
        function renderRecordList() {
            const period = document.querySelector('.record-tab.active').dataset.period;
            const sortType = document.getElementById('sortSelect').value;
            
            let filteredSongs = filterByPeriod(allSongs, period);
            filteredSongs = sortSongs(filteredSongs, sortType);
            
            const recordList = document.getElementById('recordList');
            recordList.innerHTML = '';
            
            filteredSongs.forEach((song, index) => {
                const item = document.createElement('div');
                item.className = 'record-item';
                item.innerHTML = `
                    <img src="${song.image}" class="record-thumb" alt="${song.title}">
                    <div class="record-info">
                        <h3>${song.title}</h3>
                        <p>${song.artist}</p>
                    </div>
                    <button class="record-play-btn">
                        <svg class="icon-play" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        <svg class="icon-pause" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 5h4v14H6zm8 0h4v14h-4z"/>
                        </svg>
                    </button>
                `;
                
                // 아이템 클릭 시 재생/일시정지 토글
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.record-play-btn')) {
                        // 이미 재생 중인 곡이면 일시정지
                        if (currentPlayingSong && currentPlayingSong.title === song.title && isPlaying) {
                            pause();
                        } else if (currentPlayingSong && currentPlayingSong.title === song.title && !isPlaying) {
                            // 일시정지된 곡이면 재생
                            play();
                        } else {
                            // 새로운 곡 재생
                            const insertIndex = currentIndex + 1;
                            playerQueue.splice(insertIndex, 0, song);
                            selectTrack(insertIndex);
                        }
                    }
                });
                
                // 재생 버튼 클릭
                const playButton = item.querySelector('.record-play-btn');
                playButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // 이미 재생 중인 곡이면 일시정지
                    if (currentPlayingSong && currentPlayingSong.title === song.title && isPlaying) {
                        pause();
                    } else if (currentPlayingSong && currentPlayingSong.title === song.title && !isPlaying) {
                        // 일시정지된 곡이면 재생
                        play();
                    } else {
                        // 새로운 곡 재생
                        const insertIndex = currentIndex + 1;
                        playerQueue.splice(insertIndex, 0, song);
                        selectTrack(insertIndex);
                    }
                });
                
                recordList.appendChild(item);
            });
            
            // 렌더링 후 아이콘 상태 업데이트
            updateRecordItemIcons();
        }

        // 탭 전환
        document.querySelectorAll('.record-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.record-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                renderRecordList();
            });
        });

        // 정렬 변경
        document.getElementById('sortSelect').addEventListener('change', renderRecordList);

        // 플레이어 버튼 이벤트
        playBtn.addEventListener('click', () => {
            if (!isPlaying) {
                play();
            } else {
                pause();
            }
        });

        prevBtn.addEventListener('click', prevTrack);
        nextBtn.addEventListener('click', nextTrack);

        // 프로필 드롭다운
        const userProfile = document.querySelector('.user-profile');
        const profileDropdown = document.querySelector('.profile-dropdown');
        const profileCloseBtn = document.querySelector('.profile-close-btn');
        const logoutBtn = document.querySelector('.logout-btn');

        userProfile.addEventListener('click', (e) => {
            e.stopPropagation();
            const isVisible = profileDropdown.style.display === 'block';
            profileDropdown.style.display = isVisible ? 'none' : 'block';
        });

        profileCloseBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            profileDropdown.style.display = 'none';
        });

        logoutBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            alert('로그아웃되었습니다.');
            profileDropdown.style.display = 'none';
        });

        document.addEventListener('click', (e) => {
            if (!userProfile.contains(e.target)) {
                profileDropdown.style.display = 'none';
            }
        });

        // 초기 렌더링
        currentTimeSpan.textContent = formatTime(0);
        document.querySelector('.total-time').textContent = formatTime(totalDuration);
        renderRecordList();

        
            // 로그인 체크 + 사용자 이름 표시
    (function checkLogin() {
      const loggedInUser = sessionStorage.getItem('loggedInUser');

      if (!loggedInUser) {
        // 로그인 정보가 없으면 로그인 페이지로 리다이렉트
        alert('로그인이 필요한 서비스입니다.');
        window.location.href = '1_에쁠킬라_Login.html';
      } else {

        const user = JSON.parse(loggedInUser);

        // 프로필 드롭다운의 닉네임 표시
        const profileNickname = document.querySelector('.profile-nickname');
        if (profileNickname) {
          profileNickname.textContent = user.name + '님';
        }
      }
    })();
    </script>
</body>
</html>
